<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description" content="A site with statistics regarding how concentrated user data is on various web services" />
    <meta charset="utf-8">
    <title>Are We Decentralized Yet?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Robert Ricci">

    <script type="text/javascript" src="justgage-1.2.2/raphael-2.1.4.min.js""></script>
    <script type="text/javascript" src="justgage-1.2.2/justgage.js"></script>

    <script type="text/javascript" src="data.js"></script>

    <link rel="stylesheet" href="css/index.css">

</head>

<body>
  
    <h1>Are We Decentralized Yet?</h1>

    <noscript>
        <div style="color: red; font-weight: bold; text-align: center">
          ⚠️ JavaScript is disabled in your browser. Please enable it to use this site properly.
        </div>
    </noscript>

    <div class="container">
      <h2>How Concentrated Is User Data On:</h2>
      <div class="rating">
        <h3>The Fediverse</h3>
        <h5>Mastodon, Pixelfed, etc.</h5>
        <div id="gageFedi" class="gage"></div>
        <div class="shannon">
          <div class="index">Shannon Index: <span id="fediShannon"></span></div>
          <div class="trend">One-week trend: <span id="fediShannonTrend"></span> (<span id="fediShannonTrendPct"></span>%)</div>
          <div class="icon"><img id="fediShannonIcon"> <span id="fediShannonText"></span></div>
        </div>
        <table>
            <tr><th>Servers</th><td><span id="fediServers"></span></td></tr>
            <tr><th>Biggest</th><td><span id="fediBiggestAbs"></span></td><td>(<span id="fediBiggestPct"></span>%)</td></tr>
            <tr><th>Rest</th><td><span id="fediRestAbs"></span></td><td>(<span id="fediRestPct"></span>%)</td></tr>
        </table>
      </div>
      <div class="rating">
        <h3>The Atmosphere</h3>
        <h5>Bluesky, WhiteWind, etc.</h5>
        <div id="gageAtmosphere" class="gage"></div>
        <div class="shannon">
          <div class="index">Shannon Index: <span id="atShannon"></span></div>
          <div class="trend">One-week trend: <span id="atShannonTrend"></span> (<span id="atShannonTrendPct"></span>%)</div>
          <div class="icon"><img id="atShannonIcon"> <span id="atShannonText"></span></div>
        </div>
        <table>
            <tr><th>PDSes</th><td><span id="atServers"></span></td></tr>
            <tr><th>Biggest</th><td><span id="atBiggestAbs"></span></td><td>(<span id="atBiggestPct"></span>%)</td></tr>
            <tr><th>Rest</th><td><span id="atRestAbs"></span></td><td>(<span id="atRestPct"></span>%)</td></tr>
        </table>
      </div>
      <div class="rating">
        <h3>Public Git Forges</h3>
        <h5>Github, Gitlab, etc.</h5>
        <div id="gageGit" class="gage"></div>
        <div class="shannon">
          <div class="index">Shannon Index: <span id="gitShannon"></span></div>
          <div class="trend">One-week trend: <span id="gitShannonTrend"></span> (<span id="gitShannonTrendPct"></span>%)</div>
          <div class="icon"><img id="gitShannonIcon"> <span id="gitShannonText"></span></div>
        </div>
        <table>
            <tr><th>Forges</th><td><span id="gitServers"></span></td></tr>
            <tr><th>Biggest</th><td><span id="gitBiggestAbs"></span></td><td>(<span id="gitBiggestPct"></span>%)</td></tr>
            <tr><th>Rest</th><td><span id="gitRestAbs"></span></td><td>(<span id="gitRestPct"></span>%)</td></tr>
        </table>
      </div>
      <h4>Data last updated: <span id="lastUpdate"></span></h4>
    </div>

    <div class="container">
      <p>
        This page measures the concentration of user data on the <a
          href="https://fediverse.party/">Fediverse</a>, the <a
          href="https://atproto.com/">Atmosphere</a>, and public git forges according to the
        <a href="https://en.wikipedia.org/wiki/Herfindahl%E2%80%93Hirschman_index">Herfindahl–Hirschman
        Index</a> (HHI) and the <a href="https://en.wikipedia.org/wiki/Diversity_index#Shannon_index">Shannon Index</a>.
        User data is only one way to measure centralization: others include network structure, legal exposure, and
        concentration of social and technical power.
      </p>

      <p>
        <b>HHI</b> is an indicator from economics used to measure competition between firms in
        an industry.
        Mathematically, HHI is the sum of the squares of market shares of all servers.
        Values close to zero indicate perfectly competitive markets (eg. many servers, with users
        spread evenly), while values close to 10000 indicate highly concentrated monopolies (eg.
        most users on a single server). In economics, values below 100 are considered
        "Highly Competitive", below 1500 is "Unconcentrated", and above 2500 is
        considered "Highly Concentrated".
      </p>

      <p>
        The <b>Shannon Index</b> is an entropy-based measure used in ecological studies. Because it is logarithmic,
        it is more responsive than HHI to changes in the "smaller players".
        It is computed as Shannon entropy using the natural log: the negative sum over all servers of the "market
        share" times the log of the market share. Lower values indicate lower entropy (a high concentration of one species),
        while higher values indicate a more even population. In this context,
        the maximum value is the natural log of the number of servers.
      </p>

      <p>
        For the social networks, this site measures the concentration of user data for active users: in the
        Fediverse, this data is on <a href="https://w3c.github.io/activitypub/#server-to-server-interactions">servers</a> (also known as instances);
        in the Atmosphere, it is on the
        <a
          href="https://atproto.com/guides/glossary#pds-personal-data-server">PDSes</a>
        that host users' <a
          href="https://atproto.com/guides/glossary#data-repo">data repos</a>.
        All PDSes run by the company Bluesky Social PBC are aggregated in this
        dataset, since they are under the control of a single entity. Similarly,
        mastodon.social and mastodon.online are combined as they are run by the
        same company.
      </p>

      <p>
        For the public git forges, this site uses the number of "origins" of type "git" archived
        by <a href="https://softwareheritage.org">Software Heritage</a>; this is
        roughly equivalent to the number of git repositories they crawl. Software
        Heritage's archive coverage can be found on <a href="https://archive.softwareheritage.org/">their coverage page</a>.

      </p>

      <p>
        Code and data are available <a href="https://codeberg.org/ricci/are-we-decentralized-yet">on
          Codeberg</a>.
        Comments and pull requests, including other metrics for measuring
        distribution and resiliency, are welcome!
      </p>

      <p>
        By Rob Ricci: <a href="https://discuss.systems/@ricci">@ricci@discuss.systems</a> / 
            <a href="https://bsky.app/profile/ricci.io">@ricci.io</a> 
      </p>

          
    </div>


    <script>
    var defaults = {
      min: 0,
      max: 10000,
      titleFontFamily: "Kade-Regular",
      valueFontFamily: "Kade-Regular",
      valueFontColor: "white",
      txtMinimum: "competitive", 
      txtMaximum: "concentrated", 
      pointer: "true",
      titlePosition: "below",
      label: "HHI",
      pointerOptions: {
          toplength: -10,
          bottomlength: 5,
          bottomwidth: 6,
          color: '#8e8e93',
          stroke: '#ffffff',
          stroke_width: 2,
          stroke_linecap: 'round'
        },
    };

    var gFedi = new JustGage({
      id: "gageFedi",
      value: data["fedi"]["HHI"],
      defaults
    });
    var gAtmpsphere = new JustGage({
      id: "gageAtmosphere",
      value: data["at"]["HHI"],
      defaults
    });
    var gAtmpsphere = new JustGage({
      id: "gageGit",
      value: data["git"]["HHI"],
      defaults
    });

    function addCommas(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function formatSignedFloat(value, digits = 2) {
      const fixed = value.toFixed(digits);
      return (value >= 0 ? "+" : "") + fixed;
    }

    const shannon_trend_threshold = 1.0;
    function trend_icon(value) {
        if (value  >= shannon_trend_threshold) {
            return "img/increase.svg";
        } else if (value <= -shannon_trend_threshold) {
            return "img/decrease.svg";
        } else {
            return "img/flat.svg";
        }
    }

    function trend_text(value) {
        if (value  >= shannon_trend_threshold) {
            return "Decentralizing";
        } else if (value <= -shannon_trend_threshold) {
            return "Centralizing";
        } else {
            return "Holding Steady";
        }
    }

    document.getElementById("lastUpdate").textContent = data.lastUpdate; 

    document.getElementById("fediServers").textContent = addCommas(data.fedi.servers);
    document.getElementById("atServers").textContent = addCommas(data.at.servers);
    document.getElementById("gitServers").textContent = addCommas(data.git.servers);

    document.getElementById("fediBiggestAbs").textContent = addCommas(data.fedi.biggest_abs);
    document.getElementById("fediBiggestPct").textContent = data.fedi.biggest_pct;
    document.getElementById("fediShannon").textContent = data.fedi.shannon;
    document.getElementById("fediRestAbs").textContent = addCommas(data.fedi.rest_abs);
    document.getElementById("fediRestPct").textContent = data.fedi.rest_pct;

    document.getElementById("atBiggestAbs").textContent = addCommas(data.at.biggest_abs);
    document.getElementById("atBiggestPct").textContent = data.at.biggest_pct;
    document.getElementById("atRestAbs").textContent = addCommas(data.at.rest_abs);
    document.getElementById("atRestPct").textContent = data.at.rest_pct;
    document.getElementById("atShannon").textContent = data.at.shannon;

    document.getElementById("gitBiggestAbs").textContent = addCommas(data.git.biggest_abs);
    document.getElementById("gitBiggestPct").textContent = data.git.biggest_pct;
    document.getElementById("gitRestAbs").textContent = addCommas(data.git.rest_abs);
    document.getElementById("gitRestPct").textContent = data.git.rest_pct;
    document.getElementById("gitShannon").textContent = data.git.shannon;

    document.getElementById("fediShannonTrend").textContent = data.trends.fedi.weekly_shannon.toFixed(4);
    const fediShannonTrendPct = data.trends.fedi.weekly_shannon * 100 / data.fedi.shannon;
    document.getElementById("fediShannonTrendPct").textContent = formatSignedFloat(fediShannonTrendPct);
    document.getElementById("fediShannonIcon").src = trend_icon(fediShannonTrendPct);
    document.getElementById("fediShannonText").textContent = trend_text(fediShannonTrendPct);

    document.getElementById("atShannonTrend").textContent = data.trends.at.weekly_shannon.toFixed(4);
    const atShannonTrendPct = data.trends.at.weekly_shannon * 100 / data.at.shannon;
    document.getElementById("atShannonTrendPct").textContent = formatSignedFloat(atShannonTrendPct);
    document.getElementById("atShannonIcon").src = trend_icon(atShannonTrendPct);
    document.getElementById("atShannonText").textContent = trend_text(atShannonTrendPct);

    document.getElementById("gitShannonTrend").textContent = data.trends.git.weekly_shannon.toFixed(4);
    const gitShannonTrendPct = data.trends.git.weekly_shannon * 100 / data.git.shannon;
    document.getElementById("gitShannonTrendPct").textContent = formatSignedFloat(gitShannonTrendPct);
    document.getElementById("gitShannonIcon").src = trend_icon(gitShannonTrendPct);
    document.getElementById("gitShannonText").textContent = trend_text(gitShannonTrendPct);
    </script>

</body>
</html>
